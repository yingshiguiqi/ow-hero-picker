<Window x:Class="OwHeroPicker.Views.MainWindow"
        x:Name="RootWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:OwHeroPicker.ViewModels"
        Title="å®ˆæœ›å…ˆé”‹è‹±é›„é€‰æ‹©åŠ©æ‰‹" 
        Height="800" Width="1200"
        MinHeight="600" MinWidth="900"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}">
    
    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="60"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <Border Grid.Row="0" Background="{StaticResource BackgroundLightBrush}" 
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
            <Grid Margin="20,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Logo -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="âš”" FontSize="24" Foreground="{StaticResource PrimaryBrush}" Margin="0,0,10,0"/>
                    <TextBlock Text="å®ˆæœ›å…ˆé”‹" FontSize="20" FontWeight="Bold" Foreground="{StaticResource PrimaryBrush}"/>
                    <TextBlock Text="è‹±é›„é€‰æ‹©åŠ©æ‰‹" FontSize="16" Foreground="{StaticResource TextSecondaryBrush}" 
                               VerticalAlignment="Bottom" Margin="8,0,0,2"/>
                </StackPanel>

                <!-- å¯¼èˆªæ ‡ç­¾ -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <RadioButton Content="åœ°å›¾æŽ¨è" GroupName="Nav" IsChecked="True"
                                 Style="{StaticResource NavButton}" Command="{Binding SwitchTabCommand}" CommandParameter="maps"/>
                    <RadioButton Content="å®žæˆ˜é¢æ¿" GroupName="Nav" 
                                 Style="{StaticResource NavButton}" Command="{Binding SwitchTabCommand}" CommandParameter="battle"/>
                    <RadioButton Content="å…‹åˆ¶å…³ç³»" GroupName="Nav" 
                                 Style="{StaticResource NavButton}" Command="{Binding SwitchTabCommand}" CommandParameter="counters"/>
                </StackPanel>

                <!-- ç‰ˆæœ¬ -->
                <TextBlock Grid.Column="2" Text="v1.0.0" Foreground="{StaticResource TextSecondaryBrush}" 
                           VerticalAlignment="Center" FontSize="12"/>
            </Grid>
        </Border>

        <!-- ä¸»å†…å®¹åŒº - å®žæˆ˜é¢æ¿ï¼ˆé‡æ–°å¸ƒå±€ï¼šæŽ¨èåŒºä¸ºä¸»ï¼Œé€‰äººåŒºä¸ºè¾…ï¼‰ -->
        <Grid Grid.Row="1" Margin="20" Visibility="{Binding CurrentTab, Converter={StaticResource TabVisibilityConverter}, ConverterParameter=battle}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="260"/>
                <ColumnDefinition Width="*" MinWidth="400"/>
                <ColumnDefinition Width="240"/>
            </Grid.ColumnDefinitions>

            <!-- å·¦ä¾§ï¼šå®žæˆ˜é¢æ¿ -->
            <Border Grid.Column="0" Style="{StaticResource CardBorder}" Margin="0,0,10,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- æ ‡é¢˜ -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                            <TextBlock Text="âš”" FontSize="18" Foreground="{StaticResource PrimaryBrush}" Margin="0,0,8,0"/>
                            <TextBlock Text="å®žæˆ˜é¢æ¿" Style="{StaticResource TitleText}"/>
                            <Button Content="æ¸…ç©º" Style="{StaticResource LinkButton}" 
                                    Command="{Binding ClearAllCommand}" HorizontalAlignment="Right" Margin="20,0,0,0"/>
                        </StackPanel>

                        <!-- æ•Œæ–¹é˜µå®¹ -->
                        <Border Background="#08EF4444" CornerRadius="8" Padding="12" Margin="0,0,0,12">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="âš”" Margin="0,0,6,0" Foreground="#EF4444"/>
                                    <TextBlock Text="æ•Œæ–¹é˜µå®¹" Foreground="#EF4444" FontWeight="SemiBold"/>
                                    <TextBlock Text=" (0/5)" Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>
                                <ItemsControl ItemsSource="{Binding BattleState.EnemyTeam}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <UniformGrid Columns="5"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Width="40" Height="40" CornerRadius="6" Margin="2"
                                                    Background="#15EF4444" BorderThickness="0">
                                                <Grid>
                                                    <!-- åº•çº¹å›¾æ ‡ï¼ˆæžæ·¡ï¼‰ -->
                                                    <TextBlock Text="âš”" FontSize="16" Foreground="#0AEF4444"
                                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                                               Visibility="{Binding Converter={StaticResource NullToVisibilityConverter}}"/>
                                                    <Image Source="{Binding Converter={StaticResource HeroIdToAvatarConverter}}" 
                                                           Stretch="UniformToFill"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>

                        <!-- å·±æ–¹é˜µå®¹ -->
                        <Border Background="#083B82F6" CornerRadius="8" Padding="12" Margin="0,0,0,12">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="ðŸ›¡" Margin="0,0,6,0" Foreground="#3B82F6"/>
                                    <TextBlock Text="å·±æ–¹é˜µå®¹" Foreground="#3B82F6" FontWeight="SemiBold"/>
                                    <TextBlock Text=" (0/5)" Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>
                                <ItemsControl ItemsSource="{Binding BattleState.MyTeam}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <UniformGrid Columns="5"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Width="40" Height="40" CornerRadius="6" Margin="2"
                                                    Background="#153B82F6" BorderThickness="0">
                                                <Grid>
                                                    <!-- åº•çº¹å›¾æ ‡ï¼ˆæžæ·¡ï¼‰ -->
                                                    <TextBlock Text="ðŸ›¡" FontSize="14" Foreground="#0A3B82F6"
                                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                                               Visibility="{Binding Converter={StaticResource NullToVisibilityConverter}}"/>
                                                    <Image Source="{Binding Converter={StaticResource HeroIdToAvatarConverter}}" 
                                                           Stretch="UniformToFill"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>

                        <!-- é˜µå®¹åˆ†æž -->
                        <Border Background="#1A7C3AED" CornerRadius="8" Padding="12">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="ðŸ“Š" Margin="0,0,6,0" Foreground="#A78BFA"/>
                                    <TextBlock Text="é˜µå®¹åˆ†æž" Foreground="#A78BFA" FontWeight="SemiBold"/>
                                </StackPanel>
                                <TextBlock Text="è¯·å…ˆåœ¨å·±æ–¹é˜µå®¹ä¸­æ·»åŠ è‹±é›„" 
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           HorizontalAlignment="Center" Margin="0,16"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- ä¸­é—´ï¼šè‹±é›„é€‰æ‹©ï¼ˆç´§å‡‘æ¨¡å¼ï¼‰ -->
            <Border Grid.Column="1" Style="{StaticResource CardBorder}" Margin="10,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- æ ‡é¢˜ - æ–œä½“ç¡¬æœ—é£Žæ ¼ -->
                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="é€‰æ‹©è‹±é›„" FontSize="16" FontWeight="Bold"                                        Foreground="{StaticResource TextBrush}"/>
                            <TextBlock Grid.Column="1" Text="å·¦é”®å·±æ–¹ Â· å³é”®æ•Œæ–¹" 
                                       Foreground="{StaticResource TextMutedBrush}" FontSize="10" VerticalAlignment="Center"/>
                        </Grid>
                        
                        <!-- â•â•â•â•â•â•â•â•â•â•â• å¦å…‹ â•â•â•â•â•â•â•â•â•â•â• -->
                        <Border Margin="0,8,0,0" CornerRadius="4" Padding="8,6">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                    <GradientStop Color="#20F5C542" Offset="0"/>
                                    <GradientStop Color="#00F5C542" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <TextBlock Text="å¦å…‹" Foreground="{StaticResource TankBrush}" FontWeight="Bold" FontSize="13"/>
                        </Border>
                        <Border Margin="0,8,0,20" Padding="0">
                            <StackPanel>
                                <ItemsControl ItemsSource="{Binding Tanks}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate><WrapPanel/></ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Button Style="{StaticResource HeroButton}" 
                                                    ToolTip="{Binding Name}"
                                                    Command="{Binding DataContext.AddToMyCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding Id}">
                                                <Button.ContextMenu>
                                                    <ContextMenu>
                                                        <MenuItem Header="æ·»åŠ åˆ°æ•Œæ–¹" 
                                                                  Command="{Binding DataContext.AddToEnemyCommand, Source={x:Reference Name=RootWindow}}"
                                                                  CommandParameter="{Binding Id}"/>
                                                    </ContextMenu>
                                                </Button.ContextMenu>
                                                <StackPanel>
                                                    <Border Width="44" Height="44" CornerRadius="6" Background="{StaticResource BackgroundLightBrush}">
                                                        <Image Source="{Binding AvatarPath, Converter={StaticResource HeroAvatarConverter}}" Stretch="UniformToFill"/>
                                                    </Border>
                                                    <TextBlock Text="{Binding Name}" FontSize="9" HorizontalAlignment="Center" 
                                                               Margin="0,3,0,0" MaxWidth="46" TextTrimming="CharacterEllipsis"
                                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                                </StackPanel>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>

                        <!-- â•â•â•â•â•â•â•â•â•â•â• è¾“å‡º â•â•â•â•â•â•â•â•â•â•â• -->
                        <Border Margin="0,0,0,0" CornerRadius="4" Padding="8,6">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                    <GradientStop Color="#20FF7B7B" Offset="0"/>
                                    <GradientStop Color="#00FF7B7B" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <TextBlock Text="è¾“å‡º" Foreground="{StaticResource DamageBrush}" FontWeight="Bold" FontSize="13"/>
                        </Border>
                        <Border Margin="0,8,0,20" Padding="0">
                            <StackPanel>
                                <ItemsControl ItemsSource="{Binding Damages}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate><WrapPanel/></ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Button Style="{StaticResource HeroButton}" 
                                                    ToolTip="{Binding Name}"
                                                    Command="{Binding DataContext.AddToMyCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding Id}">
                                                <Button.ContextMenu>
                                                    <ContextMenu>
                                                        <MenuItem Header="æ·»åŠ åˆ°æ•Œæ–¹" 
                                                                  Command="{Binding DataContext.AddToEnemyCommand, Source={x:Reference Name=RootWindow}}"
                                                                  CommandParameter="{Binding Id}"/>
                                                    </ContextMenu>
                                                </Button.ContextMenu>
                                                <StackPanel>
                                                    <Border Width="40" Height="40" CornerRadius="6" Background="{StaticResource BackgroundLightBrush}">
                                                        <Image Source="{Binding AvatarPath, Converter={StaticResource HeroAvatarConverter}}" Stretch="UniformToFill"/>
                                                    </Border>
                                                    <TextBlock Text="{Binding Name}" FontSize="8" HorizontalAlignment="Center" 
                                                               Margin="0,2,0,0" MaxWidth="42" TextTrimming="CharacterEllipsis"
                                                               Foreground="{StaticResource TextMutedBrush}"/>
                                                </StackPanel>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>

                        <!-- â•â•â•â•â•â•â•â•â•â•â• æ”¯æ´ â•â•â•â•â•â•â•â•â•â•â• -->
                        <Border Margin="0,0,0,0" CornerRadius="4" Padding="8,6">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                    <GradientStop Color="#2044FF88" Offset="0"/>
                                    <GradientStop Color="#0044FF88" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <TextBlock Text="æ”¯æ´" Foreground="{StaticResource SupportBrush}" FontWeight="Bold" FontSize="13"/>
                        </Border>
                        <Border Margin="0,8,0,0" Padding="0">
                            <StackPanel>
                                <ItemsControl ItemsSource="{Binding Supports}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate><WrapPanel/></ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Button Style="{StaticResource HeroButton}" 
                                                    ToolTip="{Binding Name}"
                                                    Command="{Binding DataContext.AddToMyCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding Id}">
                                                <Button.ContextMenu>
                                                    <ContextMenu>
                                                        <MenuItem Header="æ·»åŠ åˆ°æ•Œæ–¹" 
                                                                  Command="{Binding DataContext.AddToEnemyCommand, Source={x:Reference Name=RootWindow}}"
                                                                  CommandParameter="{Binding Id}"/>
                                                    </ContextMenu>
                                                </Button.ContextMenu>
                                                <StackPanel>
                                                    <Border Width="40" Height="40" CornerRadius="6" Background="{StaticResource BackgroundLightBrush}">
                                                        <Image Source="{Binding AvatarPath, Converter={StaticResource HeroAvatarConverter}}" Stretch="UniformToFill"/>
                                                    </Border>
                                                    <TextBlock Text="{Binding Name}" FontSize="8" HorizontalAlignment="Center" 
                                                               Margin="0,2,0,0" MaxWidth="42" TextTrimming="CharacterEllipsis"
                                                               Foreground="{StaticResource TextMutedBrush}"/>
                                                </StackPanel>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- å³ä¾§ï¼šæŽ¨èï¼ˆæ ¸å¿ƒåŒºåŸŸï¼Œæ”¾å¤§å±•ç¤ºï¼‰ -->
            <Border Grid.Column="2" Style="{StaticResource CardBorder}" Margin="10,0,0,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- æ ‡é¢˜ - æ–œä½“ç¡¬æœ—é£Žæ ¼ -->
                        <TextBlock Text="æŽ¨èé€‰æ‹©" FontSize="18" FontWeight="Bold"                                    Foreground="{StaticResource PrimaryBrush}" Margin="0,0,0,4"/>
                        <TextBlock Text="åŸºäºŽæ•Œæ–¹é˜µå®¹æ™ºèƒ½åˆ†æž" Foreground="{StaticResource TextMutedBrush}" 
                                   FontSize="11" Margin="0,0,0,16"/>

                        <ItemsControl ItemsSource="{Binding Recommendations}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{StaticResource CardBrush}" CornerRadius="10" 
                                            Padding="12" Margin="0,0,0,10" Cursor="Hand"
                                            BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="56"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- å¤§å¤´åƒ -->
                                            <Border Grid.Column="0" Width="48" Height="48" CornerRadius="8" 
                                                    Background="{StaticResource BackgroundLightBrush}"
                                                    BorderBrush="{StaticResource PrimaryBrush}" BorderThickness="2">
                                                <Image Source="{Binding Hero.AvatarPath, Converter={StaticResource HeroAvatarConverter}}" 
                                                       Stretch="UniformToFill"/>
                                            </Border>

                                            <StackPanel Grid.Column="1" Margin="10,0,0,0" VerticalAlignment="Center">
                                                <!-- è‹±é›„å + åˆ†æ•° -->
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="{Binding Hero.Name}" FontWeight="Bold" FontSize="14"
                                                               Foreground="{StaticResource TextBrush}"/>
                                                    <Border Background="{StaticResource GoodBrush}" CornerRadius="4" 
                                                            Padding="6,2" Margin="8,0,0,0" VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding Score, StringFormat='+{0}'}" 
                                                                   FontWeight="Bold" Foreground="White" FontSize="11"/>
                                                    </Border>
                                                </StackPanel>
                                                <!-- æŽ¨èç†ç”± -->
                                                <TextBlock Text="{Binding Reason}" FontSize="11" 
                                                           Foreground="{StaticResource TextSecondaryBrush}" 
                                                           TextWrapping="Wrap" Margin="0,4,0,0"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- ç©ºçŠ¶æ€ - æ˜¾ç¤ºçƒ­é—¨è‹±é›„é¢„è§ˆ -->
                        <StackPanel Visibility="{Binding Recommendations.Count, Converter={StaticResource ZeroToVisibleConverter}}">
                            <Border Background="#08FFFFFF" CornerRadius="8" Padding="12" Margin="0,0,0,12"
                                    BorderBrush="#15FFFFFF" BorderThickness="1">
                                <StackPanel>
                                    <TextBlock Text="ðŸ’¡ å¿«é€Ÿæç¤º" Foreground="{StaticResource PrimaryBrush}" 
                                               FontWeight="Bold" FontSize="12" Margin="0,0,0,8"/>
                                    <TextBlock Text="â€¢ å³é”®ç‚¹å‡»è‹±é›„æ·»åŠ åˆ°æ•Œæ–¹" FontSize="11" 
                                               Foreground="{StaticResource TextBrush}" Margin="0,2"/>
                                    <TextBlock Text="â€¢ å·¦é”®ç‚¹å‡»è‹±é›„æ·»åŠ åˆ°å·±æ–¹" FontSize="11" 
                                               Foreground="{StaticResource TextBrush}" Margin="0,2"/>
                                    <TextBlock Text="â€¢ ç³»ç»Ÿå°†è‡ªåŠ¨åˆ†æžå…‹åˆ¶å…³ç³»" FontSize="11" 
                                               Foreground="{StaticResource TextBrush}" Margin="0,2"/>
                                </StackPanel>
                            </Border>
                            <TextBlock Text="å½“å‰ç‰ˆæœ¬çƒ­é—¨è‹±é›„" Foreground="{StaticResource TextSecondaryBrush}" 
                                       FontSize="11" Margin="0,8,0,8"/>
                            <WrapPanel>
                                <Border Width="36" Height="36" CornerRadius="6" Margin="2" Background="#15FFFFFF">
                                    <Image Source="pack://application:,,,/Assets/Heroes/dva.webp" Stretch="UniformToFill"/>
                                </Border>
                                <Border Width="36" Height="36" CornerRadius="6" Margin="2" Background="#15FFFFFF">
                                    <Image Source="pack://application:,,,/Assets/Heroes/ana.webp" Stretch="UniformToFill"/>
                                </Border>
                                <Border Width="36" Height="36" CornerRadius="6" Margin="2" Background="#15FFFFFF">
                                    <Image Source="pack://application:,,,/Assets/Heroes/tracer.webp" Stretch="UniformToFill"/>
                                </Border>
                                <Border Width="36" Height="36" CornerRadius="6" Margin="2" Background="#15FFFFFF">
                                    <Image Source="pack://application:,,,/Assets/Heroes/kiriko.webp" Stretch="UniformToFill"/>
                                </Border>
                            </WrapPanel>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- åœ°å›¾æŽ¨èé¡µé¢ -->
        <Grid Grid.Row="1" Margin="20" Visibility="{Binding CurrentTab, Converter={StaticResource TabVisibilityConverter}, ConverterParameter=maps}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- åœ°å›¾åˆ—è¡¨ -->
            <Border Grid.Column="0" Style="{StaticResource CardBorder}" Margin="0,0,10,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- æ ‡é¢˜ - æ–œä½“ç¡¬æœ—é£Žæ ¼ -->
                        <TextBlock Text="é€‰æ‹©åœ°å›¾" FontSize="18" FontWeight="Bold"                                    Foreground="{StaticResource TextBrush}" Margin="0,0,0,12"/>
                        
                        <!-- åœ°å›¾æœç´¢æ¡† -->
                        <TextBox Text="{Binding MapSearchKeyword, UpdateSourceTrigger=PropertyChanged}" 
                                 Style="{StaticResource SearchTextBox}" Margin="0,0,0,16"/>
                        
                        <!-- æœç´¢ç»“æžœ -->
                        <ItemsControl ItemsSource="{Binding FilteredMaps}" 
                                      Visibility="{Binding MapSearchKeyword, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=invert}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Style="{StaticResource HeroButton}" Margin="0,2"
                                            Command="{Binding DataContext.SelectMapCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                            CommandParameter="{Binding}" HorizontalAlignment="Stretch">
                                        <Border Background="{StaticResource BackgroundLightBrush}" CornerRadius="6" 
                                                Padding="10,8" HorizontalAlignment="Stretch">
                                            <TextBlock Text="{Binding Name}" Foreground="{StaticResource PrimaryBrush}" FontWeight="SemiBold"/>
                                        </Border>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        
                        <!-- â•â•â•â•â•â•â•â•â•â•â• æŠ¢ç‚¹å›¾ â•â•â•â•â•â•â•â•â•â•â• -->
                        <TextBlock Text="æŠ¢ç‚¹å›¾" Foreground="{StaticResource PrimaryBrush}" FontWeight="Bold" 
                                   FontSize="12" Margin="0,0,0,6"/>
                        <ItemsControl ItemsSource="{Binding ControlMaps}" Margin="0,0,0,12">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Style="{StaticResource HeroButton}" Margin="0,0,0,2" HorizontalAlignment="Stretch"
                                            Command="{Binding DataContext.SelectMapCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                            CommandParameter="{Binding}">
                                        <Grid Height="36">
                                            <Border Background="#10FFFFFF" CornerRadius="4"/>
                                            <Border Width="3" Background="{StaticResource PrimaryBrush}" Opacity="0.5"
                                                    HorizontalAlignment="Left" CornerRadius="2,0,0,2"/>
                                            <TextBlock Text="{Binding Name}" Foreground="{StaticResource TextBrush}" 
                                                       FontSize="12" VerticalAlignment="Center" Margin="12,0,0,0"/>
                                        </Grid>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- â•â•â•â•â•â•â•â•â•â•â• æœºåŠ¨æŽ¨è¿›å›¾ â•â•â•â•â•â•â•â•â•â•â• -->
                        <TextBlock Text="æœºåŠ¨æŽ¨è¿›" Foreground="#22C55E" FontWeight="Bold" 
                                   FontSize="12" Margin="0,0,0,6"/>
                        <ItemsControl ItemsSource="{Binding PushMaps}" Margin="0,0,0,12">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Style="{StaticResource HeroButton}" Margin="0,0,0,2" HorizontalAlignment="Stretch"
                                            Command="{Binding DataContext.SelectMapCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                            CommandParameter="{Binding}">
                                        <Grid Height="36">
                                            <Border Background="#10FFFFFF" CornerRadius="4"/>
                                            <Border Width="3" Background="#22C55E" Opacity="0.5"
                                                    HorizontalAlignment="Left" CornerRadius="2,0,0,2"/>
                                            <TextBlock Text="{Binding Name}" Foreground="{StaticResource TextBrush}" 
                                                       FontSize="12" VerticalAlignment="Center" Margin="12,0,0,0"/>
                                        </Grid>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- â•â•â•â•â•â•â•â•â•â•â• é—ªç‚¹å›¾ â•â•â•â•â•â•â•â•â•â•â• -->
                        <TextBlock Text="é—ªç‚¹" Foreground="#F59E0B" FontWeight="Bold" 
                                   FontSize="12" Margin="0,0,0,6"/>
                        <ItemsControl ItemsSource="{Binding FlashpointMaps}" Margin="0,0,0,12">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Style="{StaticResource HeroButton}" Margin="0,0,0,2" HorizontalAlignment="Stretch"
                                            Command="{Binding DataContext.SelectMapCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                            CommandParameter="{Binding}">
                                        <Grid Height="36">
                                            <Border Background="#10FFFFFF" CornerRadius="4"/>
                                            <Border Width="3" Background="#F59E0B" Opacity="0.5"
                                                    HorizontalAlignment="Left" CornerRadius="2,0,0,2"/>
                                            <TextBlock Text="{Binding Name}" Foreground="{StaticResource TextBrush}" 
                                                       FontSize="12" VerticalAlignment="Center" Margin="12,0,0,0"/>
                                        </Grid>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- â•â•â•â•â•â•â•â•â•â•â• çº¯æŽ¨è½¦å›¾ â•â•â•â•â•â•â•â•â•â•â• -->
                        <TextBlock Text="æŠ¤é€" Foreground="#3B82F6" FontWeight="Bold" 
                                   FontSize="12" Margin="0,0,0,6"/>
                        <ItemsControl ItemsSource="{Binding EscortMaps}" Margin="0,0,0,12">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Style="{StaticResource HeroButton}" Margin="0,0,0,2" HorizontalAlignment="Stretch"
                                            Command="{Binding DataContext.SelectMapCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                            CommandParameter="{Binding}">
                                        <Grid Height="36">
                                            <Border Background="#10FFFFFF" CornerRadius="4"/>
                                            <Border Width="3" Background="#3B82F6" Opacity="0.5"
                                                    HorizontalAlignment="Left" CornerRadius="2,0,0,2"/>
                                            <TextBlock Text="{Binding Name}" Foreground="{StaticResource TextBrush}" 
                                                       FontSize="12" VerticalAlignment="Center" Margin="12,0,0,0"/>
                                        </Grid>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- â•â•â•â•â•â•â•â•â•â•â• æ··åˆæŽ¨è½¦å›¾ â•â•â•â•â•â•â•â•â•â•â• -->
                        <TextBlock Text="æ··åˆ" Foreground="#A78BFA" FontWeight="Bold" 
                                   FontSize="12" Margin="0,0,0,6"/>
                        <ItemsControl ItemsSource="{Binding HybridMaps}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Style="{StaticResource HeroButton}" Margin="0,0,0,2" HorizontalAlignment="Stretch"
                                            Command="{Binding DataContext.SelectMapCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                            CommandParameter="{Binding}">
                                        <Grid Height="36">
                                            <Border Background="#10FFFFFF" CornerRadius="4"/>
                                            <Border Width="3" Background="#A78BFA" Opacity="0.5"
                                                    HorizontalAlignment="Left" CornerRadius="2,0,0,2"/>
                                            <TextBlock Text="{Binding Name}" Foreground="{StaticResource TextBrush}" 
                                                       FontSize="12" VerticalAlignment="Center" Margin="12,0,0,0"/>
                                        </Grid>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- åœ°å›¾æŽ¨èå†…å®¹ -->
            <Border Grid.Column="1" Style="{StaticResource CardBorder}" Margin="10,0,0,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- å·¥å…·æ  -->
                        <Border Background="{StaticResource BackgroundLightBrush}" CornerRadius="6" Padding="8" Margin="0,0,0,12">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="{Binding PresetName, FallbackValue='é¢„è®¾é…ç½®'}" FontWeight="Bold" FontSize="13"
                                               Foreground="{StaticResource TextBrush}"/>
                                    <TextBlock Text="{Binding PresetStats}" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <Button Content="ç¼–è¾‘" Style="{StaticResource LinkButton}" Command="{Binding ToggleEditModeCommand}" Margin="0,0,8,0"/>
                                    <Button Content="å¯¼å‡º" Style="{StaticResource LinkButton}" Command="{Binding ExportPresetCommand}" Margin="0,0,8,0"/>
                                    <Button Content="å¯¼å…¥" Style="{StaticResource LinkButton}" Command="{Binding ImportPresetCommand}" Margin="0,0,8,0"/>
                                    <Button Content="é‡ç½®" Style="{StaticResource LinkButton}" Command="{Binding ResetPresetCommand}" Foreground="#EF4444"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- æ ‡é¢˜ -->
                        <TextBlock Text="{Binding SelectedMap.Name, FallbackValue='è¯·é€‰æ‹©åœ°å›¾'}" 
                                   FontSize="18" FontWeight="Bold" Margin="0,0,0,4"
                                   Foreground="{StaticResource TextBrush}"/>
                        
                        <!-- å­åœ°å›¾é€‰æ‹©ï¼ˆæŠ¢ç‚¹å›¾ç­‰æœ‰å­åœ°å›¾çš„ï¼‰ -->
                        <ItemsControl ItemsSource="{Binding SelectedMap.SubMaps}" Margin="0,0,0,12"
                                      Visibility="{Binding SelectedMap.SubMaps, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=invert}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate><WrapPanel/></ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Style="{StaticResource HeroButton}" Margin="0,0,6,4"
                                            Command="{Binding DataContext.SelectSubMapCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                            CommandParameter="{Binding}">
                                        <Border CornerRadius="6" Padding="10,6"
                                                Background="{StaticResource BackgroundLightBrush}">
                                            <TextBlock Text="{Binding Name}" FontSize="11" 
                                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                                        </Border>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        
                        <!-- å½“å‰é€‰ä¸­çš„å­åœ°å›¾ -->
                        <TextBlock Foreground="{StaticResource PrimaryBrush}" FontWeight="SemiBold" Margin="0,0,0,8"
                                   Visibility="{Binding SelectedSubMap, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=invert}">
                            <Run Text="å½“å‰ï¼š"/><Run Text="{Binding SelectedSubMap.Name}"/>
                        </TextBlock>
                        
                        <TextBlock Text="{Binding MapNotes}" 
                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,12"/>

                        <!-- æŽ¨è (ä¸é”™å“¦) -->
                        <Border Background="#1A22C55E" CornerRadius="8" Padding="12" Margin="0,0,0,12">
                            <StackPanel>
                                <TextBlock Text="âœ… æŽ¨è" Foreground="#22C55E" FontWeight="Bold" FontSize="14" Margin="0,0,0,8"/>
                                <ItemsControl ItemsSource="{Binding GoodHeroes}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate><WrapPanel/></ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Width="56" Height="68" Margin="3" Background="{StaticResource CardBrush}" 
                                                    CornerRadius="6" BorderBrush="#22C55E" BorderThickness="2">
                                                <StackPanel VerticalAlignment="Center">
                                                    <Border Width="36" Height="36" CornerRadius="4" HorizontalAlignment="Center">
                                                        <Image Source="{Binding AvatarPath, Converter={StaticResource HeroAvatarConverter}}" Stretch="UniformToFill"/>
                                                    </Border>
                                                    <TextBlock Text="{Binding Name}" FontSize="9" HorizontalAlignment="Center" Margin="0,3,0,0"
                                                               TextTrimming="CharacterEllipsis" MaxWidth="52"
                                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                <TextBlock Text="æš‚æ— æŽ¨èè‹±é›„" Foreground="{StaticResource TextSecondaryBrush}" FontSize="12"
                                           Visibility="{Binding GoodHeroes.Count, Converter={StaticResource ZeroToVisibleConverter}}"
                                           HorizontalAlignment="Center" Margin="0,8"/>
                            </StackPanel>
                        </Border>

                        <!-- å¤‡é€‰ (ä¸€èˆ¬èˆ¬) -->
                        <Border Background="#1AF59E0B" CornerRadius="8" Padding="12" Margin="0,0,0,12">
                            <StackPanel>
                                <TextBlock Text="âš¡ å¤‡é€‰" Foreground="#F59E0B" FontWeight="Bold" FontSize="14" Margin="0,0,0,8"/>
                                <ItemsControl ItemsSource="{Binding AverageHeroes}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate><WrapPanel/></ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Width="56" Height="68" Margin="3" Background="{StaticResource CardBrush}" 
                                                    CornerRadius="6" BorderBrush="#F59E0B" BorderThickness="2">
                                                <StackPanel VerticalAlignment="Center">
                                                    <Border Width="36" Height="36" CornerRadius="4" HorizontalAlignment="Center">
                                                        <Image Source="{Binding AvatarPath, Converter={StaticResource HeroAvatarConverter}}" Stretch="UniformToFill"/>
                                                    </Border>
                                                    <TextBlock Text="{Binding Name}" FontSize="9" HorizontalAlignment="Center" Margin="0,3,0,0"
                                                               TextTrimming="CharacterEllipsis" MaxWidth="52"
                                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                <TextBlock Text="æš‚æ— å¤‡é€‰è‹±é›„" Foreground="{StaticResource TextSecondaryBrush}" FontSize="12"
                                           Visibility="{Binding AverageHeroes.Count, Converter={StaticResource ZeroToVisibleConverter}}"
                                           HorizontalAlignment="Center" Margin="0,8"/>
                            </StackPanel>
                        </Border>

                        <!-- ä¸æŽ¨è (ä¸å¥½ç”¨) -->
                        <Border Background="#1AEF4444" CornerRadius="8" Padding="12" Margin="0,0,0,12">
                            <StackPanel>
                                <TextBlock Text="âŒ ä¸æŽ¨è" Foreground="#EF4444" FontWeight="Bold" FontSize="14" Margin="0,0,0,8"/>
                                <ItemsControl ItemsSource="{Binding BadHeroes}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate><WrapPanel/></ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Width="56" Height="68" Margin="3" Background="{StaticResource CardBrush}" 
                                                    CornerRadius="6" BorderBrush="#EF4444" BorderThickness="2">
                                                <StackPanel VerticalAlignment="Center">
                                                    <Border Width="36" Height="36" CornerRadius="4" HorizontalAlignment="Center">
                                                        <Image Source="{Binding AvatarPath, Converter={StaticResource HeroAvatarConverter}}" Stretch="UniformToFill"/>
                                                    </Border>
                                                    <TextBlock Text="{Binding Name}" FontSize="9" HorizontalAlignment="Center" Margin="0,3,0,0"
                                                               TextTrimming="CharacterEllipsis" MaxWidth="52"
                                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                <TextBlock Text="æš‚æ— ä¸æŽ¨èè‹±é›„" Foreground="{StaticResource TextSecondaryBrush}" FontSize="12"
                                           Visibility="{Binding BadHeroes.Count, Converter={StaticResource ZeroToVisibleConverter}}"
                                           HorizontalAlignment="Center" Margin="0,8"/>
                            </StackPanel>
                        </Border>

                        <!-- æœªè¯„çº§è‹±é›„ (ç¼–è¾‘æ¨¡å¼) -->
                        <Border Background="{StaticResource BackgroundLightBrush}" CornerRadius="8" Padding="12"
                                Visibility="{Binding IsEditingHeroRating, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="ðŸ“ æœªè¯„çº§è‹±é›„" Foreground="{StaticResource PrimaryBrush}" FontWeight="Bold" FontSize="14"/>
                                    <TextBlock Text=" (ç‚¹å‡»æ·»åŠ åˆ°å¯¹åº”åˆ†ç±»)" Foreground="{StaticResource TextSecondaryBrush}" FontSize="12" VerticalAlignment="Bottom"/>
                                </StackPanel>
                                <TextBlock Text="ç‚¹å‡»è‹±é›„é€‰æ‹©è¯„çº§ï¼šç»¿è‰²=æŽ¨èï¼Œæ©™è‰²=å¤‡é€‰ï¼Œçº¢è‰²=ä¸æŽ¨è" 
                                           Foreground="{StaticResource TextSecondaryBrush}" FontSize="11" Margin="0,0,0,8"/>
                                <ItemsControl ItemsSource="{Binding UnratedHeroes}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate><WrapPanel/></ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Width="56" Height="68" Margin="3" Background="{StaticResource CardBrush}" 
                                                    CornerRadius="6" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
                                                <Border.ContextMenu>
                                                    <ContextMenu>
                                                        <MenuItem Header="è®¾ä¸ºæŽ¨è" 
                                                                  Command="{Binding DataContext.SetHeroRatingCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                  CommandParameter="{Binding Id, StringFormat={}{0}|ä¸é”™å“¦}"/>
                                                        <MenuItem Header="è®¾ä¸ºå¤‡é€‰"
                                                                  Command="{Binding DataContext.SetHeroRatingCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                  CommandParameter="{Binding Id, StringFormat={}{0}|ä¸€èˆ¬èˆ¬}"/>
                                                        <MenuItem Header="è®¾ä¸ºä¸æŽ¨è"
                                                                  Command="{Binding DataContext.SetHeroRatingCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                  CommandParameter="{Binding Id, StringFormat={}{0}|ä¸å¥½ç”¨}"/>
                                                    </ContextMenu>
                                                </Border.ContextMenu>
                                                <StackPanel VerticalAlignment="Center">
                                                    <Border Width="36" Height="36" CornerRadius="4" HorizontalAlignment="Center">
                                                        <Image Source="{Binding AvatarPath, Converter={StaticResource HeroAvatarConverter}}" Stretch="UniformToFill"/>
                                                    </Border>
                                                    <TextBlock Text="{Binding Name}" FontSize="9" HorizontalAlignment="Center" Margin="0,3,0,0"
                                                               TextTrimming="CharacterEllipsis" MaxWidth="52"/>
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                <TextBlock Text="æ‰€æœ‰è‹±é›„å·²è¯„çº§" Foreground="{StaticResource TextSecondaryBrush}" FontSize="12"
                                           Visibility="{Binding UnratedHeroes.Count, Converter={StaticResource ZeroToVisibleConverter}}"
                                           HorizontalAlignment="Center" Margin="0,8"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- å…‹åˆ¶å…³ç³»é¡µé¢ -->
        <Grid Grid.Row="1" Margin="20" Visibility="{Binding CurrentTab, Converter={StaticResource TabVisibilityConverter}, ConverterParameter=counters}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="320"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- è‹±é›„åˆ—è¡¨ + æœç´¢ -->
            <Border Grid.Column="0" Style="{StaticResource CardBorder}" Margin="0,0,10,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="âš”ï¸ è‹±é›„å…‹åˆ¶å…³ç³»" Style="{StaticResource TitleText}" Margin="0,0,0,12"/>
                    
                    <!-- æœç´¢æ¡† -->
                    <Border Grid.Row="1" Background="{StaticResource BackgroundLightBrush}" CornerRadius="6" Padding="8" Margin="0,0,0,12">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="ðŸ”" VerticalAlignment="Center" Margin="0,0,8,0" 
                                       Foreground="{StaticResource TextMutedBrush}"/>
                            <TextBox Grid.Column="1" Text="{Binding SearchKeyword, UpdateSourceTrigger=PropertyChanged}" 
                                     Background="Transparent" BorderThickness="0" Foreground="White"
                                     VerticalAlignment="Center" FontSize="13">
                                <TextBox.Style>
                                    <Style TargetType="TextBox">
                                        <Setter Property="CaretBrush" Value="White"/>
                                    </Style>
                                </TextBox.Style>
                            </TextBox>
                        </Grid>
                    </Border>
                    <TextBlock Grid.Row="1" Text="æœç´¢è‹±é›„ï¼ˆæ”¯æŒå¤–å·å¦‚ï¼šç§‘æ¯”ã€å¤§é”¤ã€æ³•é¸¡ï¼‰" 
                               Foreground="{StaticResource TextSecondaryBrush}" FontSize="10" 
                               Margin="8,0,0,0" VerticalAlignment="Bottom" IsHitTestVisible="False"
                               Visibility="{Binding SearchKeyword, Converter={StaticResource NullToVisibilityConverter}}"/>

                    <!-- æœç´¢ç»“æžœæˆ–å…¨éƒ¨è‹±é›„ -->
                    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <!-- æœç´¢ç»“æžœ -->
                            <StackPanel Visibility="{Binding SearchKeyword, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=invert}">
                                <TextBlock Text="æœç´¢ç»“æžœ" Foreground="{StaticResource PrimaryBrush}" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                <ItemsControl ItemsSource="{Binding SearchResults}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Button Style="{StaticResource LinkButton}" HorizontalAlignment="Left" Margin="0,2"
                                                    Command="{Binding DataContext.SelectHeroForCounterCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}">
                                                <StackPanel Orientation="Horizontal">
                                                    <Border Width="28" Height="28" CornerRadius="4" Margin="0,0,8,0">
                                                        <Image Source="{Binding AvatarPath, Converter={StaticResource HeroAvatarConverter}}" Stretch="UniformToFill"/>
                                                    </Border>
                                                    <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                <TextBlock Text="æœªæ‰¾åˆ°åŒ¹é…è‹±é›„" Foreground="{StaticResource TextSecondaryBrush}" 
                                           Visibility="{Binding SearchResults.Count, Converter={StaticResource ZeroToVisibleConverter}}"
                                           HorizontalAlignment="Center" Margin="0,16"/>
                            </StackPanel>

                            <!-- å…¨éƒ¨è‹±é›„ -->
                            <StackPanel Visibility="{Binding SearchKeyword, Converter={StaticResource NullToVisibilityConverter}}">
                                <TextBlock Text="å¦å…‹" Foreground="{StaticResource TankBrush}" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                <ItemsControl ItemsSource="{Binding Tanks}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate><WrapPanel/></ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Button Style="{StaticResource HeroButton}" ToolTip="{Binding Name}"
                                                    Command="{Binding DataContext.SelectHeroForCounterCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}">
                                                <Border Width="36" Height="36" CornerRadius="4">
                                                    <Image Source="{Binding AvatarPath, Converter={StaticResource HeroAvatarConverter}}" Stretch="UniformToFill"/>
                                                </Border>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <TextBlock Text="è¾“å‡º" Foreground="{StaticResource DamageBrush}" FontWeight="SemiBold" Margin="0,12,0,8"/>
                                <ItemsControl ItemsSource="{Binding Damages}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate><WrapPanel/></ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Button Style="{StaticResource HeroButton}" ToolTip="{Binding Name}"
                                                    Command="{Binding DataContext.SelectHeroForCounterCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}">
                                                <Border Width="36" Height="36" CornerRadius="4">
                                                    <Image Source="{Binding AvatarPath, Converter={StaticResource HeroAvatarConverter}}" Stretch="UniformToFill"/>
                                                </Border>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <TextBlock Text="æ”¯æ´" Foreground="{StaticResource SupportBrush}" FontWeight="SemiBold" Margin="0,12,0,8"/>
                                <ItemsControl ItemsSource="{Binding Supports}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate><WrapPanel/></ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Button Style="{StaticResource HeroButton}" ToolTip="{Binding Name}"
                                                    Command="{Binding DataContext.SelectHeroForCounterCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}">
                                                <Border Width="36" Height="36" CornerRadius="4">
                                                    <Image Source="{Binding AvatarPath, Converter={StaticResource HeroAvatarConverter}}" Stretch="UniformToFill"/>
                                                </Border>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>

            <!-- å…‹åˆ¶è¯¦æƒ… -->
            <Border Grid.Column="1" Style="{StaticResource CardBorder}" Margin="10,0,0,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- è‹±é›„ä¿¡æ¯å¤´éƒ¨ -->
                        <Border Background="{StaticResource BackgroundLightBrush}" CornerRadius="8" Padding="16" Margin="0,0,0,16">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Border Width="64" Height="64" CornerRadius="8" Margin="0,0,16,0">
                                    <Image Source="{Binding SelectedHeroForCounter.AvatarPath, Converter={StaticResource HeroAvatarConverter}}" Stretch="UniformToFill"/>
                                </Border>
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding SelectedHeroForCounter.Name, FallbackValue='è¯·é€‰æ‹©è‹±é›„æŸ¥çœ‹å…‹åˆ¶å…³ç³»'}" 
                                               FontSize="20" FontWeight="Bold" Foreground="{StaticResource TextBrush}"/>
                                    <TextBlock Text="{Binding SelectedHeroForCounter.NameEn}" 
                                               Foreground="{StaticResource TextSecondaryBrush}" FontSize="12"/>
                                    <TextBlock Text="{Binding WeaknessNote}" 
                                               Foreground="#F59E0B" FontSize="12" Margin="0,4,0,0" TextWrapping="Wrap"
                                               Visibility="{Binding WeaknessNote, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=invert}"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- è¢«è°å…‹åˆ¶ï¼ˆå¼±ç‚¹ï¼‰- ä½¿ç”¨å·¦ä¾§ç«–æ¡æ ‡è®° -->
                        <Border Background="{StaticResource CardBrush}" CornerRadius="8" Padding="0" Margin="0,0,0,12">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="4"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Border Background="#F85149" CornerRadius="4,0,0,4"/>
                                <StackPanel Grid.Column="1" Margin="12">
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                        <TextBlock Text="è¢«å…‹åˆ¶" Foreground="#F85149" FontWeight="Bold" FontSize="14"/>
                                        <TextBlock Text=" Â· é€‰è¿™äº›è‹±é›„æ¥æ‰“ä»–" Foreground="{StaticResource TextMutedBrush}" FontSize="11" VerticalAlignment="Bottom"/>
                                    </StackPanel>
                                    <ItemsControl ItemsSource="{Binding Weaknesses}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate><WrapPanel/></ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Button Style="{StaticResource HeroButton}" Margin="2"
                                                        Command="{Binding DataContext.SelectHeroForCounterCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                        CommandParameter="{Binding Hero}">
                                                    <Button.ToolTip>
                                                        <StackPanel>
                                                            <TextBlock Text="{Binding Hero.Name}" FontWeight="Bold"/>
                                                            <TextBlock Text="{Binding ScoreText}" Foreground="#F85149"/>
                                                        </StackPanel>
                                                    </Button.ToolTip>
                                                    <Grid Width="52" Height="64">
                                                        <!-- å¤´åƒ+è¾¹æ¡†ï¼ˆè¾¹æ¡†ç²—ç»†æ ¹æ®å…‹åˆ¶ç­‰çº§å˜åŒ–ï¼‰ -->
                                                        <Border Width="48" Height="48" CornerRadius="6" VerticalAlignment="Top"
                                                                BorderBrush="{Binding TierText, Converter={StaticResource TierToBorderBrushConverter}, ConverterParameter=red}"
                                                                BorderThickness="{Binding BorderWidth}"
                                                                Background="{StaticResource BackgroundLightBrush}">
                                                            <Border.Effect>
                                                                <DropShadowEffect Color="#F85149" BlurRadius="6" ShadowDepth="0" Opacity="0.5"/>
                                                            </Border.Effect>
                                                            <Image Source="{Binding Hero.AvatarPath, Converter={StaticResource HeroAvatarConverter}}" Stretch="UniformToFill"/>
                                                        </Border>
                                                        <!-- Tier è§’æ ‡ -->
                                                        <Border Background="{Binding TierText, Converter={StaticResource TierToBackgroundConverter}}" 
                                                                CornerRadius="4" Padding="4,1" 
                                                                HorizontalAlignment="Left" VerticalAlignment="Top" Margin="-4,-4,0,0">
                                                            <TextBlock Text="{Binding TierText}" FontSize="10" FontWeight="Bold" Foreground="White"/>
                                                        </Border>
                                                        <!-- è‹±é›„å -->
                                                        <TextBlock Text="{Binding Hero.Name}" FontSize="9" HorizontalAlignment="Center" 
                                                                   VerticalAlignment="Bottom" MaxWidth="50" TextTrimming="CharacterEllipsis"
                                                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                                                    </Grid>
                                                </Button>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                    <TextBlock Text="æš‚æ— å…‹åˆ¶æ•°æ®" Foreground="{StaticResource TextMutedBrush}" FontSize="12"
                                               Visibility="{Binding Weaknesses.Count, Converter={StaticResource ZeroToVisibleConverter}}"
                                               HorizontalAlignment="Center" Margin="0,8"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- å…‹åˆ¶è°ï¼ˆä¼˜åŠ¿ï¼‰- ä½¿ç”¨å·¦ä¾§ç«–æ¡æ ‡è®° -->
                        <Border Background="{StaticResource CardBrush}" CornerRadius="8" Padding="0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="4"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Border Background="#3FB950" CornerRadius="4,0,0,4"/>
                                <StackPanel Grid.Column="1" Margin="12">
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                        <TextBlock Text="å…‹åˆ¶" Foreground="#3FB950" FontWeight="Bold" FontSize="14"/>
                                        <TextBlock Text=" Â· ç”¨ä»–æ¥æ‰“è¿™äº›è‹±é›„" Foreground="{StaticResource TextMutedBrush}" FontSize="11" VerticalAlignment="Bottom"/>
                                    </StackPanel>
                                    <ItemsControl ItemsSource="{Binding Strengths}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate><WrapPanel/></ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Button Style="{StaticResource HeroButton}" Margin="2"
                                                        Command="{Binding DataContext.SelectHeroForCounterCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                        CommandParameter="{Binding Hero}">
                                                    <Button.ToolTip>
                                                        <StackPanel>
                                                            <TextBlock Text="{Binding Hero.Name}" FontWeight="Bold"/>
                                                            <TextBlock Text="{Binding ScoreText}" Foreground="#3FB950"/>
                                                        </StackPanel>
                                                    </Button.ToolTip>
                                                    <Grid Width="52" Height="64">
                                                        <!-- å¤´åƒ+è¾¹æ¡†ï¼ˆè¾¹æ¡†ç²—ç»†æ ¹æ®å…‹åˆ¶ç­‰çº§å˜åŒ–ï¼‰ -->
                                                        <Border Width="48" Height="48" CornerRadius="6" VerticalAlignment="Top"
                                                                BorderBrush="{Binding TierText, Converter={StaticResource TierToBorderBrushConverter}, ConverterParameter=green}"
                                                                BorderThickness="{Binding BorderWidth}"
                                                                Background="{StaticResource BackgroundLightBrush}">
                                                            <Border.Effect>
                                                                <DropShadowEffect Color="#3FB950" BlurRadius="6" ShadowDepth="0" Opacity="0.5"/>
                                                            </Border.Effect>
                                                            <Image Source="{Binding Hero.AvatarPath, Converter={StaticResource HeroAvatarConverter}}" Stretch="UniformToFill"/>
                                                        </Border>
                                                        <!-- Tier è§’æ ‡ -->
                                                        <Border Background="{Binding TierText, Converter={StaticResource TierToBackgroundConverter}}" 
                                                                CornerRadius="4" Padding="4,1" 
                                                                HorizontalAlignment="Left" VerticalAlignment="Top" Margin="-4,-4,0,0">
                                                            <TextBlock Text="{Binding TierText}" FontSize="10" FontWeight="Bold" Foreground="White"/>
                                                        </Border>
                                                        <!-- è‹±é›„å -->
                                                        <TextBlock Text="{Binding Hero.Name}" FontSize="9" HorizontalAlignment="Center" 
                                                                   VerticalAlignment="Bottom" MaxWidth="50" TextTrimming="CharacterEllipsis"
                                                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                                                    </Grid>
                                                </Button>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                    <TextBlock Text="æš‚æ— å…‹åˆ¶æ•°æ®" Foreground="{StaticResource TextMutedBrush}" FontSize="12"
                                               Visibility="{Binding Strengths.Count, Converter={StaticResource ZeroToVisibleConverter}}"
                                               HorizontalAlignment="Center" Margin="0,8"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>
    </Grid>
</Window>
